---
title: "Untitled"
author: "Winson & Daniel"
date: "2023-12-13"
output: html_document
---

#Library
```{r}
library(dplyr)
library(tidyr)
library(caret)
library(shiny)
```

## A.Data Loading dan Preprocessing
# 1. Load Dataset
```{r}
# CP = Calon Pendaftar
CP = read.csv('profiling.csv', sep = ";")
CP
str(CP)

# HK = Hasil Kelulusan
HK = read.csv('admisi.csv', sep = ";")
HK
str(HK)
```
# 2. Merge Dataset, Check missing value, Duplicate, Outlier
```{r}
# merge data
Data = merge(CP, HK, by = "ID")
Data
str(Data)

anyNA(Data)
anyDuplicated(Data)

# remove duplicate
Data = unique(Data)
str(Data)
Data

# labeling Riset
Data <- Data %>%
  na.omit() %>%
  mutate(RISET = ifelse(RISET == "Ya", 1, 0)) %>%
  mutate(RISET = as.numeric(RISET))

# labeling Jenis kelamin
Data$JENIS_KEL [Data$JENIS_KEL == " L"] = 1 
Data$JENIS_KEL [Data$JENIS_KEL == " P"] = 2
Data$JENIS_KEL = as.numeric(Data$JENIS_KEL)

# cleaning IPK
Data = Data %>%
  mutate(IPK = gsub("," , "." , IPK)) %>%
  mutate(IPK = as.numeric(IPK)) %>%
  mutate(IPK = ifelse(IPK > 4, NA, IPK)) %>%
  na.omit() 

# cleaning Surat Rekomendasi & Motivation Letter
Data = Data %>%
  mutate(MOT_LETTER =  gsub("," , "." , MOT_LETTER)) %>%
  mutate(REKOM_LETTER =  gsub("," , "." , REKOM_LETTER)) %>%
  mutate(MOT_LETTER = as.numeric(MOT_LETTER)) %>%
  mutate(REKOM_LETTER = as.numeric(REKOM_LETTER)) 

Data = Data %>%
 mutate(MOT_LETTER = ifelse(MOT_LETTER > 5 | MOT_LETTER < 1, NA, MOT_LETTER)) %>%
  mutate(REKOM_LETTER = ifelse(REKOM_LETTER > 5 | REKOM_LETTER < 1, NA, REKOM_LETTER)) %>%
  na.omit()

Data

# Feature Selection
Data = Data %>%
  select(-ID) %>%
  select(-NAMA) 
  
```

# 5. Simple Randomsplit Training Testing 80:20
```{r}
set.seed(123)
split = sample(nrow(Data), size = 0.8 * nrow(Data), replace = F)
training = Data[split,]
testing = Data[-split,]
```

# B. Modeling dan Evaluasi
# Model 1 (Logistic Regression)
```{r}
model1 = glm(LULUS ~., data=training, family = "binomial")

summary(model1)

# testing accuracy
probs = predict(model1, newdata=testing, type="response")
accuracy = mean(testing$LULUS == as.numeric(probs>0.5))
print(accuracy)

testing$LULUS <- as.factor(testing$LULUS)
predicted <- as.factor(as.numeric(probs > 0.5))
confusionMatrix(testing$LULUS, predicted)

Data
```

# Shiny
```{r}
# UI
ui <- fluidPage(
  titlePanel("IEDU Prediction Tool"),
  div(
    style = "display: flex; justify-content: center; align-items: center;",
    div(
      style = "width: 1000px; padding: 20px; background-color: #ffffff; border-radius: 10px;",
      sidebarLayout(
        sidebarPanel(
          radioButtons("jenis_kelamin", "Jenis Kelamin", c("L", "P"), selected = NULL),
          numericInput("usia", "Usia", value = NULL),
          numericInput("ranking_uni_asal", "Ranking Universitas Asal", value = NULL),
          radioButtons("riset", "Apakah Melakukan Riset?", c("Ya", "Tidak"), selected = NULL),
          numericInput("GRE", "GRE", value = NULL),
          numericInput("TOEFL", "TOEFL", value = NULL)
        ),
        mainPanel(
          actionButton("submit", "Submit"),
          textOutput("prediksi")
        )
      ),
      style = "overflow-y: scroll;"
    )
  )
)

# Server
server <- function(input, output) {
  values <- reactiveValues(
    jenis_kelamin = NA,
    riset = NA,
    usia = NA,
    ranking_uni_asal = NA,
    GRE = NA,
    TOEFL = NA
  )

  observeEvent(input$submit, {
    values$jenis_kelamin <- input$jenis_kelamin
    values$riset <- input$riset

    # Create data frame for prediction
    data_for_prediction <- data.frame(
      jenis_kelamin = values$jenis_kelamin,
      riset = values$riset,
      usia = input$usia,
      ranking_uni_asal = input$ranking_uni_asal,
      GRE = input$GRE,
      TOEFL = input$TOEFL
    )

    probs <- predict(model1, newdata = data_for_prediction, type = "response")
    prediksi <- ifelse(probs > 0.5, 1, 0)

    # Display results
    output$prediksi <- renderText({
      paste("Peluang lulus:", probs, ", Prediksi lulus:", prediksi)
    })
  })
}

# Run the app
shinyApp(ui, server)

```